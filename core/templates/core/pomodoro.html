{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Study Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    /* Smooth fade for background image */
    .bg-transition {
      transition: background-image 0.6s ease-in-out;
    }

    /* Overlay blur background for cards */
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
  </style>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-papNMp+QfG0XgIR+YfBcT4gQwVwRVzQX0T0GJvY5C72vHq8MyQ3SfHq6vS2uX3F1QH7+1m0LPF9jNnqIDgR4xQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

</head>

<body class="bg-gray-900 text-gray-800 font-sans min-h-screen flex flex-col items-center justify-center p-6 bg-center bg-cover bg-no-repeat bg-transition"
  id="pageBg"
  style="background-image: url('{% static 'core/images/pom1.jfif' %}')">

  <a href="{% url 'home' %}" 
     class="fixed top-4 left-4 bg-purple-700 hover:bg-purple-800 text-white px-4 py-2 rounded-xl shadow-md flex items-center gap-2 transition">
    <i class="fa-solid fa-arrow-left"></i> Home
  </a>
  <!-- Background Chooser -->
  <div class="fixed top-4 right-4 bg-white/80 p-2 rounded-lg shadow-lg backdrop-blur-md w-40">
    <h2 class="text-sm font-semibold text-purple-700 mb-2 text-center">Choose BG</h2>
    <div class="grid grid-cols-3 gap-1">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom1.jfif' %}">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom2.jfif' %}">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom3.jfif' %}">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom4.jfif' %}">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom5.jfif' %}">
        <img class="background rounded-md cursor-pointer hover:opacity-80 transition w-10 h-10 object-cover" src="{% static 'core/images/pom6.jfif' %}">
    </div>
   </div>


  <!-- Dashboard Cards -->
  <div class="w-full max-w-6xl grid grid-cols-3 gap-6 p-6">
    
    <!-- Clock -->
    <div class="glass rounded-2xl p-6 text-center shadow-lg">
      <button class="clock bg-purple-700 text-white px-5 py-2 rounded-lg hover:bg-purple-800 transition font-semibold">Digital Clock</button>
      <div id="waqt1" class="mt-4 text-3xl font-mono text-purple-800"></div>
    </div>

    <!-- To-do List -->
    <div class="glass rounded-2xl p-6 shadow-lg text-center">
      <h2 class="font-semibold text-purple-700 mb-3 text-lg">To-Do List</h2>
      <div class="flex justify-center items-center gap-2 mb-4">
        <input type="text" class="itemAdd border rounded-lg px-3 py-2 text-sm w-3/4" placeholder="Add a task" />
        <button id="addButton" class="bg-purple-700 text-white px-3 py-2 rounded-lg hover:bg-purple-800">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      <ul class="itemList text-left text-sm space-y-2"></ul>
    </div>

    <!-- Pomodoro -->
    <div class="glass rounded-2xl p-6 text-center shadow-lg">
      <button class="pomodoro bg-purple-700 text-white px-5 py-2 rounded-lg hover:bg-purple-800 transition font-semibold">Pomodoro Timer</button>
      <div id="waqt" class="mt-4 text-xl text-purple-700"></div>
      <p id="pomoCounter" class="text-sm text-purple-600 mt-2">Completed: 0</p>
    </div>

    <!-- Notes -->
    <div class="glass rounded-2xl p-6 text-center shadow-lg col-span-2">
      <div class="write cursor-pointer text-purple-700 flex justify-center items-center gap-2">
        <i class="fa-solid fa-book-open"></i>
        <span class="font-medium text-lg">Write Note</span>
      </div>
      <div class="diary mt-3"></div>
    </div>

    <!-- Music -->
    <div class="glass rounded-2xl p-6 text-center shadow-lg">
      <div class="player cursor-pointer text-purple-700 flex justify-center items-center gap-2">
        <i class="fa-solid fa-music"></i>
        <span class="font-medium text-lg">Play Music</span>
      </div>
      <div class="spotify mt-3"></div>
    </div>
  </div>

  <script>
    /* Background change */
    const thumbnails = document.querySelectorAll(".background");
    const pageBg = document.getElementById("pageBg");

    thumbnails.forEach(img => {
      img.addEventListener("click", function() {
        pageBg.style.backgroundImage = `url('${img.src}')`;
      });
    });

    /* Clock */
    const time = document.querySelector(".clock");
    const digiclock = document.getElementById("waqt1");
    let clockStarted = false;

    time.addEventListener("click", function() {
      if (clockStarted) return;
      clockStarted = true;
      setInterval(() => {
        const currentTime = new Date();
        digiclock.textContent = currentTime.toLocaleTimeString();
      }, 1000);
    });

    /* To-Do List */
    const input = document.querySelector(".itemAdd");
    const addButton = document.getElementById("addButton");
    const itemList = document.querySelector(".itemList");

    addButton.addEventListener("click", () => {
      const taskItem = input.value.trim();
      if (taskItem !== "") {
        const task = document.createElement("li");
        task.className = "flex justify-between items-center bg-purple-200 px-3 py-2 rounded-lg";
        task.innerHTML = `
          <span>${taskItem}</span>
          <div class="flex gap-2">
            <input type="checkbox" class="check">
            <i class="fa-solid fa-xmark text-purple-700 cursor-pointer"></i>
          </div>
        `;
        itemList.appendChild(task);
        input.value = "";

        const checkbox = task.querySelector(".check");
        const removeButton = task.querySelector(".fa-xmark");

        checkbox.addEventListener("change", () => {
          task.classList.toggle("line-through");
          task.classList.toggle("opacity-60");
        });

        removeButton.addEventListener("click", () => {
          task.remove();
        });
      }
    });

    /* Pomodoro */
    const pomo = document.querySelector(".pomodoro");
    const waqt = document.getElementById("waqt");
    const pomoCounter = document.getElementById("pomoCounter");
    let completedSessions = 0;

    pomo.addEventListener("click", () => {
      const buttons = `
        <div class="flex justify-center gap-4 mt-3">
          <button id="long" class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-800">Long Break</button>
          <button id="short" class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-800">Short Break</button>
        </div>`;
      waqt.innerHTML = buttons;

      function startTimer(duration, label) {
        let timeLeft = duration;
        let timer;
        let running = false;
        waqt.innerHTML = `
          <div class="text-3xl font-mono text-purple-800 mb-4" id="display"></div>
          <div class="flex justify-center gap-4">
            <button id="start" class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-800"><i class="fa-solid fa-play"></i></button>
            <button id="pause" class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-800"><i class="fa-solid fa-pause"></i></button>
            <button id="reset" class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-800"><i class="fa-solid fa-rotate-right"></i></button>
          </div>
        `;

        const display = document.getElementById("display");
        const updateDisplay = () => {
          let mins = Math.floor(timeLeft / 60);
          let secs = timeLeft % 60;
          display.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        };
        updateDisplay();

        const startBtn = document.getElementById("start");
        const pauseBtn = document.getElementById("pause");
        const resetBtn = document.getElementById("reset");

        startBtn.addEventListener("click", () => {
          if (running) return;
          running = true;
          timer = setInterval(() => {
            if (timeLeft > 0) {
              timeLeft--;
              updateDisplay();
            } else {
              clearInterval(timer);
              running = false;
              completedSessions++;
              pomoCounter.textContent = `Completed: ${completedSessions}`;
              alert(`${label} finished!`);
            }
          }, 1000);
        });

        pauseBtn.addEventListener("click", () => {
          clearInterval(timer);
          running = false;
        });

        resetBtn.addEventListener("click", () => {
          clearInterval(timer);
          timeLeft = duration;
          running = false;
          updateDisplay();
        });
      }

      document.getElementById("long").addEventListener("click", () => startTimer(1500, "Long Break"));
      document.getElementById("short").addEventListener("click", () => startTimer(300, "Short Break"));
    });

    /* Notes */
    const notesBtn = document.querySelector(".write");
    const diary = document.querySelector(".diary");

    notesBtn.addEventListener("click", () => {
        // Create note container
        const noteContainer = document.createElement("div");
        noteContainer.className = "note bg-white p-3 rounded-lg shadow-md mt-3 flex flex-col gap-2 relative";

        // Textarea for note
        const slate = document.createElement("textarea");
        slate.placeholder = "Write your note here...";
        slate.className = "w-full h-24 p-2 rounded-lg border text-sm focus:outline-none focus:ring-2 focus:ring-purple-400 resize-none";

        // Delete button (trash icon)
        const deleteBtn = document.createElement("i");
        deleteBtn.className = "fa-solid fa-trash text-purple-700 cursor-pointer absolute top-2 right-2 hover:text-red-600 transition";

        // Append note & delete button
        noteContainer.append(deleteBtn, slate);
        diary.append(noteContainer);

        // Delete note event
        deleteBtn.addEventListener("click", () => {
        noteContainer.remove();
        });
    });


    const musicButton = document.querySelector(".player");
    const spotify = document.querySelector(".spotify");

    const lofiTracks = [
      { name: "â˜• Morning Coffee", src: "{% static 'core/music/lofi1.mp3' %}" },
      { name: "ðŸŒ™ Night Walk", src: "{% static 'core/music/lofi2.mp3' %}" },
      { name: "ðŸŒ¸ Sakura Dreams", src: "{% static 'core/music/lofi3.mp3' %}" },
      { name: "ðŸ’« Rainy Mood", src: "{% static 'core/music/lofi4.mp3' %}" },
    ];

    let audioPlayer;
    let songListVisible = false;

    musicButton.addEventListener("click", () => {
      spotify.innerHTML = "";
      songListVisible = !songListVisible;
      if (!songListVisible) return;

      // Create list of songs
      const songList = document.createElement("ul");
      songList.className = "space-y-2 text-left";

      lofiTracks.forEach(track => {
        const listItem = document.createElement("li");
        listItem.textContent = track.name;
        listItem.className =
          "cursor-pointer hover:text-purple-700 transition font-medium bg-purple-100 px-3 py-1 rounded-lg";

        listItem.addEventListener("click", () => {
          // Create player if not already there
          if (!audioPlayer) {
            audioPlayer = document.createElement("audio");
            audioPlayer.controls = true;
            audioPlayer.className =
              "mt-3 w-full rounded-lg shadow-md bg-purple-200/40";
            spotify.append(audioPlayer);
          }
          audioPlayer.src = track.src;
          audioPlayer.play();
        });

        songList.appendChild(listItem);
      });

      spotify.appendChild(songList);
    });

  </script>
</body>
</html>
